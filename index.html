<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Door Status</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #connectionStatus {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        #lamp {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: red;
        }
        table {
            width: 50%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
        }
    </style>
</head>
<body>

    <!-- Connectivity Status -->
    <div id="connectionStatus">
        <div id="lamp"></div>
        <span id="statusText">ESP32 Offline</span>
    </div>

    <!-- Door Status Table -->
    <h2>Door Status</h2>
    <table>
        <tr>
            <th>Door</th>
            <th>Status</th>
        </tr>
        <tr><td>Door 1</td><td id="door1">Waiting...</td></tr>
        <tr><td>Door 2</td><td id="door2">Waiting...</td></tr>
        <tr><td>Door 3</td><td id="door3">Waiting...</td></tr>
        <tr><td>Door 4</td><td id="door4">Waiting...</td></tr>
    </table>

    <script>
    // Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyCKuUI96FqwGG3QnKOM9iIyKqwpB8u3VGA",
        authDomain: "casier-4p.firebaseapp.com",
        databaseURL: "https://casier-4p-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "casier-4p",
        storageBucket: "casier-4p.firebasestorage.app",
        messagingSenderId: "713240306801",
        appId: "1:713240306801:web:924270f06594b4f284a7d0",
        measurementId: "G-NL57LCHD65"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        let lastUpdateTime = 0;

        function updateConnectionStatus() {
            const now = Date.now();
            const lamp = document.getElementById("lamp");
            const statusText = document.getElementById("statusText");

            if (now - lastUpdateTime < 5000) {
                lamp.style.backgroundColor = "green";
                statusText.innerText = "ESP32 Online";
                statusText.style.color = "green";
            } else {
                lamp.style.backgroundColor = "red";
                statusText.innerText = "ESP32 Offline";
                statusText.style.color = "red";
            }
        }

        function updateDoorStatus(door, status) {
            document.getElementById("door" + door).innerText = status;
        }

        function checkDoorStatus() {
            for (let i = 1; i <= 4; i++) {
                const doorRef = database.ref("doorStatus/door" + i);

                doorRef.on("value", function(snapshot) {
                    if (snapshot.exists()) {
                        updateDoorStatus(i, snapshot.val());
                        lastUpdateTime = Date.now();
                    } else {
                        updateDoorStatus(i, "Disconnected");
                    }
                }, function(error) {
                    console.error("Firebase error:", error);
                    updateDoorStatus(i, "Disconnected");
                });
            }

            setInterval(updateConnectionStatus, 2000);
        }

        window.onload = checkDoorStatus;
    </script>

</body>
</html>
